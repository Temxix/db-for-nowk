# NOWK Message Server

Сервер для обмена сообщениями с поддержкой шифрования и MongoDB.

## Описание

NOWK Message Server - это REST API сервер, который предоставляет функционал для:
- Регистрации пользователей
- Обмена зашифрованными сообщениями
- Управления чатами между пользователями
- Безопасного хранения данных в MongoDB

## Технический стек

- Java 24
- Spring Boot 3.4.5
- MongoDB Atlas
- Maven
- RSA шифрование

## Требования

- JDK 24
- Maven 3.8+
- MongoDB Atlas аккаунт
- Доступ к интернету

## Установка и настройка

1. Клонируйте репозиторий:
```bash
git clone [url-репозитория]
cd db-for-nowk
```

2. Создайте аккаунт на [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)

3. Создайте новый кластер в MongoDB Atlas

4. Получите строку подключения к базе данных

5. Настройте `application.properties`:
```properties
spring.data.mongodb.uri=ваша_строка_подключения
spring.data.mongodb.database=NOWK_DB
```

## Запуск

```bash
mvn spring-boot:run
```

Сервер запустится на порту 8080 и будет доступен по адресу `http://localhost:8080`

## API Endpoints

### Пользователи

#### Регистрация пользователя
```
POST /api/users/register
Content-Type: application/json

{
    "name": "имя_пользователя",
    "publicKey": "публичный_ключ_RSA"
}
```

#### Получение списка пользователей
```
GET /api/users/names
```
Возвращает список всех зарегистрированных пользователей.

#### Приветственное сообщение
```
GET /api/users/welcome?name=имя_пользователя
```
Возвращает приветственное сообщение в формате JSON:
```json
{
    "message": "Добро пожаловать!",
    "username": "имя_пользователя"
}
```

#### Получение чатов пользователя
```
GET /api/users/chats/list?username=имя_пользователя
```
Возвращает список всех чатов пользователя. Чат создается автоматически при отправке первого сообщения.

### Сообщения

#### Отправка сообщения
```
POST /api/messages
Content-Type: application/json

{
    "text": "текст_сообщения",
    "username": "отправитель",
    "recipient": "получатель",
    "hash": "хеш_сообщения"
}
```
При первой отправке сообщения автоматически создается чат между пользователями. Поле `hash` обязательно и должно содержать хеш текста сообщения, вычисленный на стороне клиента.

#### Получение сообщений
```
GET /api/messages?username=имя_пользователя&recipient=имя_получателя
```
Возвращает список сообщений в формате:
```json
[
{
        "text": "текст_сообщения",
        "timestamp": "2024-03-21T10:30:00",
        "sentByMe": true,
        "hash": "хеш_сообщения"
}
]
```

#### Удаление всех сообщений
```
DELETE /api/messages?username=имя_пользователя&recipient=имя_получателя
```
Удаляет все сообщения между двумя пользователями.

### Примеры использования

#### Пример отправки сообщения
```
POST /api/messages
Content-Type: application/json

{
    "text": "текст_сообщения",
    "username": "отправитель",
    "recipient": "получатель",
    "hash": "хеш_сообщения"
}
```

#### Пример получения сообщений
```
GET /api/messages?username=имя_пользователя&recipient=имя_получателя
```

#### Пример удаления всех сообщений
```
DELETE /api/messages?username=имя_пользователя&recipient=имя_получателя
```