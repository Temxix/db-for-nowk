# Message Server

Сервер для обмена зашифрованными сообщениями с использованием MongoDB и Spring Boot.

## Требования

- Java 24
- Maven
- MongoDB Atlas (облачная база данных)

## Конфигурация

1. Создайте аккаунт на [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Создайте новый кластер
3. Получите строку подключения
4. Настройте `application.properties`:
```properties
spring.data.mongodb.uri=ваша_строка_подключения
spring.data.mongodb.database=NOWK_DB
```

## Запуск

```bash
mvn spring-boot:run
```

Сервер запустится на порту 8080.

## API Endpoints

### Пользователи

#### Регистрация пользователя
```
POST /api/users/register
Content-Type: application/json

{
    "name": "имя_пользователя",
    "publicKey": "публичный_ключ_RSA"
}
```

#### Получение списка пользователей
```
GET /api/users/names
```

#### Получение приветственного сообщения
```
GET /api/users/welcome?name=имя_пользователя
```
Возвращает зашифрованное приветственное сообщение, используя публичный ключ пользователя.

### Сообщения

#### Отправка сообщения
```
POST /api/messages
Content-Type: application/json

{
    "content": "текст_сообщения",
    "username": "отправитель",
    "recipient": "получатель"
}
```
Сообщение автоматически шифруется с использованием публичного ключа получателя. Если отправитель и получатель разные, создаются два зашифрованных сообщения:
- Одно для получателя (зашифровано его публичным ключом)
- Одно для отправителя (зашифровано его публичным ключом)

#### Получение сообщений пользователя
```
GET /api/messages?username=имя_пользователя&recipient=имя_получателя
```
Возвращает список сообщений между двумя пользователями. Каждое сообщение содержит:
- Зашифрованное содержимое (зашифровано публичным ключом пользователя)
- Информацию об отправителе и получателе
- Временную метку
- Флаг `isSentByMe`, показывающий, является ли пользователь `username` отправителем

## Безопасность

- Все сообщения шифруются с использованием RSA-шифрования
- Каждый пользователь должен предоставить свой публичный RSA-ключ при регистрации
- Сообщения хранятся в зашифрованном виде в MongoDB
- Каждое сообщение шифруется с использованием публичного ключа получателя
- При отправке сообщения другому пользователю создаются два зашифрованных сообщения:
  - Одно для получателя (зашифровано его ключом)
  - Одно для отправителя (зашифровано его ключом)
- Строка подключения к базе данных хранится в переменных окружения

## Примеры использования

### Регистрация пользователя
```bash
curl -X POST http://localhost:8080/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"name":"test","publicKey":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA..."}'
```

### Получение сообщений
```bash
curl http://localhost:8080/api/messages?username=test&recipient=user2
```

### Отправка сообщения
```bash
curl -X POST http://localhost:8080/api/messages \
  -H "Content-Type: application/json" \
  -d '{"content":"Привет!","username":"user1","recipient":"user2"}'
```

## Технологии

- Spring Boot 3.4.5
- MongoDB
- Spring Data MongoDB
- Lombok
- RSA шифрование
